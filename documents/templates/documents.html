<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documents</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">
    {% include 'header.html' %}

    <div class="w-full p-8">
        <div class="mx-auto bg-white rounded-lg shadow-md w-full p-6">
            <h1 class="text-4xl font-bold text-blue-900 py-4 px-2">üìÑ Documents</h1>
            <div class="overflow-x-auto">
                
                <!-- documents table start -->
                <table class="w-full table-fixed bg-white border border-gray-300">
                    <thead>
                        <tr class="bg-blue-900 text-white">
                            <th class="w-12 p-2">
                                <input type="checkbox" id="select-all-documents" class="form-checkbox h-4 w-4">
                            </th>
                            <th class="w-24 p-2 break-words">Chapter</th>
                            <th class="w-40 p-2 break-words">Title</th>
                            <th class="w-48 p-2 break-words">URL</th>
                            <th class="w-24 p-2 break-words">Page Count</th>
                            <th class="w-24 p-2 break-words">Word Count</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for document in documents %}
                        <tr id="document-{{ document.id }}">
                            <td class="w-12 p-2">
                                <input type="checkbox" class="document-checkbox form-checkbox h-4 w-4" id="document-checkbox-{{ document.id }}" value="{{ document.id }}">
                            </td>
                            <td class="w-24 p-2 break-words whitespace-normal">
                                <a href="{{ url_for('documents.view_document', id=document.id) }}" class="text-blue-600 hover:text-blue-800 underline">
                                    {{ document.chapter }}
                                </a>
                            </td>
                            <td class="w-48 p-2 break-words whitespace-normal">
                                {{ document.title }}
                            </td>
                            <td class="w-64 p-2 break-words whitespace-normal">
                                <a href="{{ document.url }}" class="text-blue-600 hover:text-blue-800 underline" target="_blank">
                                    {{ document.url }}
                                </a>
                            </td>
                            <td class="w-24 p-2 break-words whitespace-normal">
                                {{ document.page_count|default('N/A', true) }}
                            </td>
                            <td class="w-24 p-2 break-words whitespace-normal">
                                {{ document.word_count|default('N/A', true) }}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>

                <!-- documents table end -->
            </div>
            
            <!-- Buttons  -->
            <div class="mb-4">
                <button id="addDocsFromSources" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
                    üåê Add Docs from Sources
                </button>
                <button id="extractMissingFullText" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-2">
                    üì• Extract Missing Full Texts
                </button>
                <span id="addDocsResult" class="ml-4 text-sm"></span>
                <span id="extractResult" class="ml-4 text-sm"></span>
            </div>
        </div>
    </div>

    <script>

        // Select All Documents from Select All Checkbox
        document.getElementById('select-all-documents').addEventListener('change', function() {
            const isChecked = this.checked;
            document.querySelectorAll('.document-checkbox').forEach(checkbox => {
                checkbox.checked = isChecked;
            });
        });
        
    document.getElementById('extractMissingFullText').addEventListener('click', function() {
        this.disabled = true;
        this.textContent = 'üîÑ Processing...';
        document.getElementById('extractResult').textContent = '';
    
        fetch('/documents/extract_missing_full_text', {
            method: 'POST',
        })
        .then(response => response.json())
        .then(data => {
            document.getElementById('extractResult').textContent = data.message;
            this.textContent = 'üì• Extract Missing Full Texts';
            this.disabled = false;
        })
        .catch(error => {
            console.error('Error:', error);
            document.getElementById('extractResult').textContent = 'An error occurred';
            this.textContent = 'üì• Extract Missing Full Texts';
            this.disabled = false;
        });
    });
    
    document.getElementById('addDocsFromSources').addEventListener('click', function() {
        this.disabled = true;
        this.textContent = 'üîÑ Processing...';
        document.getElementById('addDocsResult').textContent = '';
    
        fetch('/documents/add_docs_from_sources', {
            method: 'POST',
        })
        .then(response => response.json())
        .then(data => {
            document.getElementById('addDocsResult').textContent = data.message;
            this.textContent = 'üåê Add Docs from Sources';
            this.disabled = false;
        })
        .catch(error => {
            console.error('Error:', error);
            document.getElementById('addDocsResult').textContent = 'An error occurred';
            this.textContent = 'üåê Add Docs from Sources';
            this.disabled = false;
        });
    });
</script>
    
</body>
</html>